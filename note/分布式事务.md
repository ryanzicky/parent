## 分布式事务

### 1. 事务简介

事务是访问并可能更新数据中各种数据项的一个程序执行单元。在关系数据库中，一个事务由一组SQL语句组成。事务应该具有4个属性：原子性，一致性，隔离性，持久性。这四个属性通常称为ACID特性。

**原子性(Atomicity)：**每个事务是一个不可分割的工作单位，事务中包括的诸操作要么都做，要么都不做。

**一致性(Consistency)：**事务必须是使数据库从一个一致性状态变到另一个一致性状态，事务的中间状态不能被观察到。

**隔离性(Isolation)：**一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能相互干扰。隔离性又分为四个级别：读未提交(Read UnCommitted)，读已提交(Read Committed，解决脏读)，可重复读(Repeatable Read，解决虚读)，串行化(Serializable，解决幻读)。

**持久性(Durability)：**持久性也称永久性(Permanence)，指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的，接下来的其他操作或操作不应该对其有任何影响。

任何事务机制在实现时，都应该考虑事务的ACID特性，包括：本地事务，分布式事务，即使不能都很好的满足，也要考虑支持到什么程度。



### 2. 本地事务

大多数场景下，我们的应用场景都只需要操作单一的数据库，这种情况下的事务称之为本地事务(Local Transaction)。本地事务的ACID特性是数据库直接提供支持，本地事务应用架构如下所示：